<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: 데이터 과학</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    
    <!--
    <div id="google_translate_element"></div><script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({pageLanguage: 'ko', includedLanguages: 'en', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
    }
    </script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    -->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">데이터 과학</h1></a>
          <h2 class="subtitle">R 정규표현식과 문자데이터</h2>
          <p><a href="regex-r.html">R 정규표현식</a>에서 정규표현식을 이해했으니, 이를 활용하여 텍스트 데이터를 R에서 처리해본다.</p>
<h3 id="부---r-기초-문자열-처리-regex-intro-regex-r">1부 - R 기초 문자열 처리 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> <a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></h3>
<h4 id="시작환경-설정">시작환경 설정</h4>
<p><code>stringr</code> 팩키지를 설치하지 않았다면 설치하고 관련된 팩키지를 불러온다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;stringr&quot;)</span>
<span class="kw">library</span>(<span class="st">&quot;stringr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</code></pre></div>
<h4 id="nchar---각-문자열-길이를-센다."><code>nchar</code> - 각 문자열 길이를 센다.</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_str &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;STAT545 is great!&quot;</span>, <span class="st">&quot;Wooooo!&quot;</span>)
<span class="kw">nchar</span>(test_str)</code></pre></div>
<pre class="output"><code>[1] 17  7
</code></pre>
<h4 id="substr-문자벡터-문자열-부분집합을-뽑아내거나-바꾸기-한다."><code>substr</code> 문자벡터 문자열 부분집합을 뽑아내거나 바꾸기 한다.</h4>
<p>1번에서 7번째까지 문자열 요소를 뽑아내자.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">substr</span>(test_str, <span class="dv">1</span>, <span class="dv">7</span>)</code></pre></div>
<pre class="output"><code>[1] &quot;STAT545&quot; &quot;Wooooo!&quot;
</code></pre>
<p>1번에서 7번째까지 문자열 요소를 <code>SCIENCE</code>로 바꾼다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">substr</span>(test_str, <span class="dv">1</span>, <span class="dv">7</span>) &lt;-<span class="st"> &quot;SCIENCE&quot;</span>
test_str</code></pre></div>
<pre class="output"><code>[1] &quot;SCIENCE is great!&quot; &quot;SCIENCE&quot;          
</code></pre>
<h4 id="paste---문자열을-붙이거나-조합한다."><code>paste</code> - 문자열을 붙이거나 조합한다.</h4>
<p>다소 복잡한 함수라, 일반적인 사용례를 살펴보자. <code>sep</code> 매개변수가 구분문자를 정의한다. (기본디폴트 설정으로 한칸 공백).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;efg&quot;</span>)</code></pre></div>
<pre class="output"><code>[1] &quot;abc efg&quot;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;efg&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<pre class="output"><code>[1] &quot;abcefg&quot;
</code></pre>
<p><code>paste0</code> 함수는 <code>paste(..., sep=&quot;&quot;)</code> 을 줄여놓은 함수다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste0</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;efg&quot;</span>)</code></pre></div>
<pre class="output"><code>[1] &quot;abcefg&quot;
</code></pre>
<p>다수 값을 갖는 벡터를 조합하려면, <code>collapse</code> 매개변수로 명세한다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">paste</span>(<span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;efg&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;hij&quot;</span>, <span class="st">&quot;klm&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</code></pre></div>
<pre class="output"><code>[1] &quot;abchijefgklm&quot;
</code></pre>
<h4 id="strsplit---문자열-리스트를-문자열로-쪼갬"><code>strsplit</code> - 문자열 리스트를 문자열로 쪼갬</h4>
<p>예를 들어, 콤마로 구분된 벡터를 다음과 같이 쪼갠다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;abc,cbe&quot;</span>, <span class="st">&quot;cb,gb,aaa&quot;</span>)
<span class="kw">strsplit</span>(x, <span class="dt">split =</span> <span class="st">&quot;,&quot;</span>)</code></pre></div>
<pre class="output"><code>[[1]]
[1] &quot;abc&quot; &quot;cbe&quot;

[[2]]
[1] &quot;cb&quot;  &quot;gb&quot;  &quot;aaa&quot;
</code></pre>
<p><code>strsplit</code> 함수는 리스트를 반환한다. 그래서 하나처럼 다뤄진다. 만약 두번째 요소를 뽑아낸다면 다음과 같이 코딩한다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">strsplit</span>(x, <span class="dt">split =</span> <span class="st">&quot;,&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">lapply</span>(function(x) x[<span class="dv">2</span>])</code></pre></div>
<pre class="output"><code>[[1]]
[1] &quot;cbe&quot;

[[2]]
[1] &quot;gb&quot;
</code></pre>
<h3 id="부---r-정규표현식">2부 - R 정규표현식</h3>
<p>1부에서 문자데이터 처리 기초를 학습했다. 강력한 문자데이터 처리를 위해서, R 기초 문자데이터 처리기술을 정규표현식과 함께 사용하는 방법을 살펴보자.</p>
<h4 id="r-정규표현식-초간단-정리">R 정규표현식 초간단 정리</h4>
<ol style="list-style-type: decimal">
<li><p>POSIX 클래스를 사용해서 <strong>\w</strong>, <strong>\d</strong>, <strong>\s</strong> 문자 클래스를 참조한다. 이들 문자클래스는 함수에도 동일하지만, 좀더 가독성이 좋다고 일부 개발자는 생각한다. <code>?regex</code> 도움말을 타이핑해서 전체를 볼수 있다. 다음에 일부 예제가 나와있다.</p>
<ul>
<li><strong>\w</strong> = [[:alnum:]]</li>
<li><strong>\d</strong> = [[:digit:]]</li>
<li><strong>\s</strong> = [[:space:]]</li>
</ul></li>
<li><p>특수문자를 탈출시키거나 문자클래스를 사용하는 경우, 문자 앞에 <strong>이중</strong> 확장기호를 사용한다. 예를 들어, <strong>* 대신에 </strong>\w**.</p></li>
</ol>
<h4 id="news_tweets-데이터-불러-읽어들이기"><code>news_tweets</code> 데이터 불러 읽어들이기</h4>
<p>4개 방송사(CBC, CNN, Al Jazeera, Reuters)에서 나온 지난주 트위터 데이터를 불러 읽어들인다. <code>twitteR</code> 팩키지를 사용해서 트위터 트윗을 수집했는데, <code>twitteR</code>은 트위터 REST API 인터페이스다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">news_tweets &lt;-<span class="st"> </span><span class="kw">read.delim</span>(<span class="st">&quot;https://www.dropbox.com/s/cbgcpkizun51wbk/news_tweets.txt?dl=1&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="dt">quote =</span> <span class="st">&quot;&quot;</span>, <span class="dt">allowEscapes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre class="error"><code>Warning in file(file, &quot;rt&quot;): cannot open URL &#39;https://www.dropbox.com/s/dl/
cbgcpkizun51wbk/news_tweets.txt&#39;: HTTP status was &#39;404 Not Found&#39;
</code></pre>
<pre class="error"><code>Error in file(file, &quot;rt&quot;): cannot open the connection to &#39;https://www.dropbox.com/s/cbgcpkizun51wbk/news_tweets.txt?dl=1&#39;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(news_tweets)</code></pre></div>
<pre class="error"><code>Error in glimpse(news_tweets): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<ul>
<li><code>user_name</code> = 트위터 사용자명(축약)</li>
<li><code>created</code> = 트윗된 날짜</li>
<li><code>retweets</code> = 현재까지 다시 트윗된 횟수</li>
<li><code>text</code> = 트윗 텍스트 원문</li>
</ul>
<h4 id="grep---텍스트-벡터에서-패턴-찾아내기"><code>grep</code> - 텍스트 벡터에서 패턴 찾아내기</h4>
<p>가장 기초적인 작업은 정규표현식으로 문자벡터를 검색하는 것이다.</p>
<p><code>grep</code>은 정규표현식과 문자벡터를 입력값으로 받아 매칭되는 <em>인덱스</em>를 반환한다.</p>
<p>정규표현식을 사용해서 <code>news_tweets</code>에 해쉬태그를 포함한 트윗을 찾아보자. 해쉬태그는 <code>#</code> 다음에 알파벳숫자가 하나 이상 따라온다. 예를 들어, #rstats, #Canada 등</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 정규표현식으로 표현하는 두가지 방법</span>
hastag_pattern &lt;-<span class="st"> &quot;#</span><span class="ch">\\</span><span class="st">w+&quot;</span>
hastag_pattern &lt;-<span class="st"> &quot;#[[:alnum:]]+&quot;</span>

<span class="kw">grep</span>(hastag_pattern, news_tweets$text)</code></pre></div>
<pre class="error"><code>Error in grep(hastag_pattern, news_tweets$text): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p><code>value=TRUE</code>를 설정하면 인덱스에 딸린 벡터 <em>실제값</em>을 반환한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(hastag_pattern, news_tweets$text, <span class="dt">value =</span> <span class="ot">TRUE</span>) %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">5</span>)</code></pre></div>
<pre class="error"><code>Error in grep(hastag_pattern, news_tweets$text, value = TRUE): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p><code>invert = TRUE</code>를 설정해서, 해쉬태그가 없는 검색결과로 반전할 수 있다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">grep</span>(hastag_pattern, news_tweets$text, <span class="dt">value =</span> <span class="ot">TRUE</span>, <span class="dt">invert =</span> <span class="ot">TRUE</span>) %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">5</span>)</code></pre></div>
<pre class="error"><code>Error in grep(hastag_pattern, news_tweets$text, value = TRUE, invert = TRUE): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<h4 id="grepl---논리-패턴-매칭"><code>grepl</code> - 논리 패턴 매칭</h4>
<p><code>grepl</code> (grep logical)은 <code>grep</code>과 유사하지만, 벡터 모든 요소에 대한 <code>TRUE</code> 혹은 <code>FALSE</code> 값을 반환한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hastag_pattern &lt;-<span class="st"> &quot;#[[:alnum:]]+&quot;</span>
<span class="kw">grepl</span>(hastag_pattern, news_tweets$text) %&gt;%<span class="st"> </span><span class="kw">head</span>(<span class="dt">n =</span> <span class="dv">10</span>)</code></pre></div>
<pre class="error"><code>Error in grepl(hastag_pattern, news_tweets$text): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p><code>dplyr</code> 팩키지 <code>filter</code>로 <code>grepl</code>을 사용해서 정규표현식으로 행을 필터링한다. url을 포함한 트윗을 필터링해서 뽑아낸다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># url regex</span>
url_pattern &lt;-<span class="st"> &quot;http[s]?://[^ ]+&quot;</span>

<span class="co"># filter news tweets using grepl</span>
hashtag_tweets &lt;-<span class="st"> </span>news_tweets %&gt;%
<span class="st">    </span><span class="kw">filter</span>(<span class="kw">grepl</span>(url_pattern, news_tweets$text))</code></pre></div>
<pre class="error"><code>Error in eval(lhs, parent, parent): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># print the first 6 rows of the resulting data frame</span>
<span class="kw">head</span>(hashtag_tweets)</code></pre></div>
<pre class="error"><code>Error in head(hashtag_tweets): 객체 &#39;hashtag_tweets&#39;를 찾을 수 없습니다
</code></pre>
<h4 id="gsub---찾기와-바꾸기"><code>gsub</code> - 찾기와 바꾸기</h4>
<p>정규표현식으로 매칭하고, 매칭된 것을 미리 지정한 문자열로 바꾼다.</p>
<p><code>gsub</code> 함수는 정규표현식, 바꾸기 문자열과, 대상문자열을 입력 인자로 받는다. <code>gsub</code> 함수는 바꾸기 문자열로 교체된 모든 <strong>모든</strong> 문자열 벡터를 반환한다.</p>
<p><code>gsub</code> 함수의 일반적인 용도는 텍스트 정제다. 예를 들어, 트윗에서 모든 url을 제거하자:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reminder of what a tweet looks like</span>
news_tweets$text[<span class="dv">20</span>]</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the url regex</span>
url_pattern &lt;-<span class="st"> &quot;http[s]?://[[:alnum:].</span><span class="ch">\\</span><span class="st">/]+&quot;</span>

<span class="co"># replace all matches to the above regex with nothing &quot;&quot;</span>
clean_tweets &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern =</span> url_pattern, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, news_tweets$text)</code></pre></div>
<pre class="error"><code>Error in gsub(pattern = url_pattern, replacement = &quot;&quot;, news_tweets$text): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_tweets[<span class="dv">20</span>]</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p><code>gsub</code> 함수를 사용해서 부가되거나 끝에 딸려오는 공백문자를 제거한다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 공백 2개 혹은 끝에 딸려오는 공백 제거 정규표현식</span>
trailing_space &lt;-<span class="st"> &quot;[ ]{2,}|[ ]+$&quot;</span>
clean_tweets &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern =</span> trailing_space, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>, clean_tweets)</code></pre></div>
<pre class="error"><code>Error in gsub(pattern = trailing_space, replacement = &quot;&quot;, clean_tweets): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a clean tweet!</span>
clean_tweets[<span class="dv">20</span>]</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p>마지막으로, <code>polit</code>로 시작되는 모든 문자를 <code>ballons</code>으로 바꾸기 한다:</p>
<p>먼저 <code>polit</code>으로 시작되는 관심 패턴을 포함하는 트윗을 뽑아낸다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poli_pattern &lt;-<span class="st"> &quot;[Pp]olit[[:alnum:]]+&quot;</span>
poli_pattern %&gt;%<span class="st"> </span><span class="kw">grep</span>(clean_tweets, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre class="error"><code>Error in grep(., clean_tweets, value = TRUE): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p>이제 이를 조합해서 <code>polit</code>로 시작되는 모든 문자를 <code>ballons</code>으로 바꾼다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poli_pattern %&gt;%<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">replacement =</span> <span class="st">&quot;balloons&quot;</span>, clean_tweets) %&gt;%<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;balloons&quot;</span>, ., <span class="dt">value =</span> <span class="ot">TRUE</span>) </code></pre></div>
<pre class="error"><code>Error in gsub(., replacement = &quot;balloons&quot;, clean_tweets): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<h3 id="부---stringr-팩키지">3부 - <code>stringr</code> 팩키지</h3>
<p>R에 다른 모든 것처럼, Hadley Wickham이 문자열처리도 효과적이고 효율적으로 다루고자 많은 기여를 했다. 문자열에 대한 기여결과가 <code>stringr</code> 팩키지로 구현되었다. 기존에 존재하던 많은 함수를 더 멋진 구문으로 구현했다. 문자열 처리 팩키지를 <code>dplyr</code>과 함께 사용해서 트윗데이터에 대한 기본적인 어휘분석을 수행한다!</p>
<p>트윗에서 “단어가 아닌” 모든 텍스트를 정제한다. 정제를 시작해보자:</p>
<ul>
<li>URL: <code>http[s]?://[[:alnum:]].\\/]+</code></li>
<li>트위터 사용자명 (예를 들어, <span class="citation">@CNN</span>): <code>@[\\w]*</code></li>
<li>해쉬태그(#rstats): <code>#[\\w]*</code></li>
<li>소유격(’s) : <code>'s</code><br />
</li>
<li>이상한 유니코드/html 태그 (예를 들어, <U008+>): <code>&lt;.*&gt;</code></li>
</ul>
<p>먼저 제거하고자 하는 각각에 대한 정규표현식을 작성한다. 그리고 나서 <code>&quot;|&quot;</code> 연산자로 조합한다. (정규표현식에서 “or”, 또는 의미를 갖는다.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stuff_to_remove &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;http[s]?://[[:alnum:].</span><span class="ch">\\</span><span class="st">/]+&quot;</span>, <span class="st">&quot;@[</span><span class="ch">\\</span><span class="st">w]*&quot;</span>, <span class="st">&quot;#[</span><span class="ch">\\</span><span class="st">w]*&quot;</span>, <span class="st">&quot;&lt;.*&gt;&quot;</span>, <span class="st">&quot;&#39;s&quot;</span>)
stuff_to_remove &lt;-<span class="st">  </span><span class="kw">paste</span>(stuff_to_remove, <span class="dt">sep =</span> <span class="st">&quot;|&quot;</span>, <span class="dt">collapse=</span><span class="st">&quot;|&quot;</span>)</code></pre></div>
<p>(<code>gsub</code> 같은) <code>str_replace_all</code> 함수를 사용해서 트윗 텍스트를 정제한다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_tweets &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(news_tweets$text, stuff_to_remove, <span class="st">&quot;&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in stri_replace_all_regex(string, pattern, fix_replacement(replacement), : 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_tweets[<span class="dv">20</span>:<span class="dv">25</span>]</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p>잘 동작되지만, 꼬리부분에 공백문자가 눈에 띈다! 다행히도, <code>stringr</code> 팩키지에는 이런 작업을 위한 전용함수가 존재한다. <code>str_trim</code> 함수는 앞쪽과 뒤쪽 공백문자를 제거한다:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_tweets &lt;-<span class="st"> </span><span class="kw">str_trim</span>(clean_tweets)</code></pre></div>
<pre class="error"><code>Error in stri_trim_both(string): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clean_tweets[<span class="dv">20</span>:<span class="dv">25</span>]</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<p>다음으로, <code>str_extract_all</code> 함수를 사용해서 전체 데이터셋에서 모든 단어를 추출한다. (<code>grep(...value=TRUE)</code>처럼)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tweet_words &lt;-<span class="st"> </span><span class="kw">str_extract_all</span>(clean_tweets, <span class="st">&quot;[A-Za-z]+&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in stri_extract_all_regex(string, pattern, simplify = simplify, : 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tweet_words)</code></pre></div>
<pre class="error"><code>Error in head(tweet_words): 객체 &#39;tweet_words&#39;를 찾을 수 없습니다
</code></pre>
<p>오키도키! 상위 15개 단어를 뽑아내자.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_counts &lt;-<span class="st"> </span><span class="kw">unlist</span>(tweet_words) %&gt;%<span class="st"> </span>table %&gt;%<span class="st"> </span>data.frame</code></pre></div>
<pre class="error"><code>Error in unlist(tweet_words): 객체 &#39;tweet_words&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(word_counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;word&quot;</span>, <span class="st">&quot;count&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in names(word_counts) &lt;- c(&quot;word&quot;, &quot;count&quot;): 객체 &#39;word_counts&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_counts %&gt;%
<span class="st">    </span><span class="kw">arrange</span>(count) %&gt;%
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">15</span>) </code></pre></div>
<pre class="error"><code>Error in eval(lhs, parent, parent): 객체 &#39;word_counts&#39;를 찾을 수 없습니다
</code></pre>
<p>흠… 정규표현식으로 사용해서 대문자로 시작되는 문자로 적어도 길이가 4자 이상되는 문자만 잡아내자.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tweet_words &lt;-<span class="st"> </span><span class="kw">str_extract_all</span>(clean_tweets, <span class="st">&quot;[A-Z][a-z]{4,}&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in stri_extract_all_regex(string, pattern, simplify = simplify, : 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_counts &lt;-<span class="st"> </span><span class="kw">unlist</span>(tweet_words) %&gt;%<span class="st"> </span>table %&gt;%<span class="st"> </span>data.frame</code></pre></div>
<pre class="error"><code>Error in unlist(tweet_words): 객체 &#39;tweet_words&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(word_counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;word&quot;</span>, <span class="st">&quot;count&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in names(word_counts) &lt;- c(&quot;word&quot;, &quot;count&quot;): 객체 &#39;word_counts&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_counts %&gt;%
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">25</span>)%&gt;%
<span class="st">    </span><span class="kw">arrange</span>(<span class="kw">desc</span>(count))</code></pre></div>
<pre class="error"><code>Error in eval(lhs, parent, parent): 객체 &#39;word_counts&#39;를 찾을 수 없습니다
</code></pre>
<p>거의 작업을 잘 마무리한 것으로 보인다. 재미로 단어 구름(word cloud)을 만들어보자.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;wordcloud&quot;)</span>
<span class="co">#install.packages(&quot;wesanderson&quot;)</span>
<span class="kw">library</span>(<span class="st">&quot;wordcloud&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in library(&quot;wordcloud&quot;): there is no package called &#39;wordcloud&#39;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;wesanderson&quot;</span>)</code></pre></div>
<pre class="error"><code>Error in library(&quot;wesanderson&quot;): there is no package called &#39;wesanderson&#39;
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pal &lt;-<span class="st"> </span><span class="kw">wes_palette</span>(<span class="dt">name =</span> <span class="st">&quot;Zissou&quot;</span>, <span class="dv">51</span>, <span class="dt">type =</span><span class="st">&quot;continuous&quot;</span>) %&gt;%<span class="st"> </span><span class="kw">as.character</span>()</code></pre></div>
<pre class="error"><code>Error in wes_palette(name = &quot;Zissou&quot;, 51, type = &quot;continuous&quot;): 함수 &quot;wes_palette&quot;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">word_counts %&gt;%
<span class="st">    </span><span class="kw">top_n</span>(<span class="dv">50</span>) %&gt;%
<span class="st">    </span><span class="kw">with</span>(<span class="kw">wordcloud</span>(word, count, <span class="dt">ordered.colors =</span> <span class="ot">TRUE</span>, <span class="dt">color =</span> pal, <span class="dt">use.r.layout =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre class="error"><code>Error in eval(lhs, parent, parent): 객체 &#39;word_counts&#39;를 찾을 수 없습니다
</code></pre>
<p>방송사별로 쪼개서 트윗에 대한 단어 구름을 만들어 보자.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">news_clean_tweets &lt;-<span class="st"> </span>news_tweets</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;news_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">news_clean_tweets$text &lt;-<span class="st"> </span>clean_tweets</code></pre></div>
<pre class="error"><code>Error in eval(expr, envir, enclos): 객체 &#39;clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">words_df &lt;-<span class="st"> </span>news_clean_tweets %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(user_name) %&gt;%
<span class="st">    </span><span class="kw">do</span>(<span class="dt">words =</span> <span class="kw">str_extract_all</span>(.$text, <span class="st">&quot;[A-Z][a-z]{4,}&quot;</span>))</code></pre></div>
<pre class="error"><code>Error in eval(lhs, parent, parent): 객체 &#39;news_clean_tweets&#39;를 찾을 수 없습니다
</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))

for (i in <span class="dv">1</span>:<span class="dv">4</span>){
    
    word_counts &lt;-<span class="st"> </span><span class="kw">unlist</span>(words_df[i, <span class="dv">2</span>]) %&gt;%<span class="st"> </span>table %&gt;%<span class="st"> </span>data.frame
    <span class="kw">names</span>(word_counts) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;word&quot;</span>, <span class="st">&quot;count&quot;</span>)
    
    word_counts %&gt;%
<span class="st">        </span><span class="kw">top_n</span>(<span class="dv">50</span>) %&gt;%
<span class="st">        </span><span class="kw">with</span>(<span class="kw">wordcloud</span>(word, count, <span class="dt">ordered.colors =</span> <span class="ot">TRUE</span>, 
            <span class="dt">color =</span> <span class="kw">wes_palette</span>(<span class="dt">name =</span> <span class="st">&quot;Zissou&quot;</span>, <span class="kw">nrow</span>(.), <span class="dt">type =</span><span class="st">&quot;continuous&quot;</span>), 
            <span class="dt">scale =</span> <span class="kw">c</span>(<span class="fl">3.5</span>, <span class="fl">0.15</span>)))
        <span class="kw">text</span>(<span class="dv">0</span>, <span class="fl">0.9</span>, words_df$user_name[i], <span class="dt">cex =</span> <span class="fl">1.5</span>, <span class="dt">adj =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))
    
}</code></pre></div>
<pre class="error"><code>Error in unlist(words_df[i, 2]): 객체 &#39;words_df&#39;를 찾을 수 없습니다
</code></pre>
<h3 id="추가-학습교재">추가 학습교재</h3>
<ul>
<li><code>stringr</code> <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">소품문</a></li>
<li>CRAN 자연어처리 : <a href="https://cran.r-project.org/web/views/NaturalLanguageProcessing.html">Task View</a></li>
<li><a href="https://www.youtube.com/watch?v=q8SzNKib5-4">R 정규표현식</a> : Roger Peng 유튜브 동영상</li>
</ul>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://stat545-ubc.github.io/block022_regular-expression.html">Regular Expression in R</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="https://stat545-ubc.github.io/block027_regular-expressions.html">Regular Expressions and Character Data</a><a href="#fnref2">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-37305346-2', 'auto');
      ga('send', 'pageview');
    
    </script>
  </body>
</html>
